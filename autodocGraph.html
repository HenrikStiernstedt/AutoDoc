<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AutoDoc for Softadmin</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Bootstrap -->
    <!--<link href="css/bootstrap.min.css" rel="stylesheet">-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <!-- Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- production version, optimized for size and speed -->
    <!--<script src="https://cdn.jsdelivr.net/npm/vue"></script>-->

		<!-- mermaid graph -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.13.10/mermaid.min.js"></script>
	
	<style>
		pre {
			background-color: lightblue;
		}
		.Path {
			white-space: nowrap;
		}
	</style>

	<script>
		var config = {
			startOnLoad:true,
			securityLevel:'loose',
		};
		
		mermaid.initialize(config);
		
	</script>
	<script>
		
		$(function() {
			var input = document.getElementById("input");
			var preview = document.getElementById("preview");
			var output = document.getElementById("output");
			var renderBtn = document.getElementById("render");

			var button = $("#render");
			
			button.click(function() {

				console.log("Knapp!");
				vm.RenderGraph();
				/*
				mermaid.render('theGraph', input.value, function(svgCode) {
					output.innerHTML = svgCode;
				});
				*/
			});
			
			var loader = $("#loader");
			
			loader.click(function() {
				console.log("Ladd knapp!");
				//input.value = $('#rawValue').text();
				vm.LoadGraph();
			});
		});							

	</script>
		


	</head>
	<body>

		<div id="app">
			<div >
				<div class="row">
					<div class="col-sm-12" >
						<h1>Du är i databasen {{status.Database}} </h1> 
						<h2>Du visar just nu objekt <span class="badge badge-primary">{{ status.CurrentItem.schema }}</span>.<span class="badge badge-primary">{{ status.CurrentItem.name }}</span></h2>
					</div>
				</div>
				<div>
					<div>
						<button type="button" id="loader">Reload</button>
						<button type="button" id="render">Render</button>
					</div>
					<div>Graph:
						<div id="output"></div>
					</div>
					<div>
						<button onClick="$('#input').toggle();">Visa debuginfo #1</button>
						<textarea name="" id="input" cols="200" rows="15" style="display:none">
						sequenceDiagram
						A->> B: Query
						B->> C: Forward query
						Note right of C: Thinking...
						C->> B: Response
						B->> A: Forward response
							</textarea>
					</div>
				</div>
			</div>
			<!-- pre-tagg för debug -->
			<button onClick="$('#rawValue').toggle();">Visa debuginfo #2</button>
			<pre id="rawValue" style="display:none">
				graph LR
					{{prock.Info.object_id}}[{{prock.Info.Name}}] 

					<template v-for="(m, index) in prock.MetaDataReference">
						<template v-if="m.Kind == 'menu item'">
							<template v-if="m.MenuItemId !== null && m.MenuItemId != undefined">
								<!-- {{m.IconCssString}} TODO: Fungerar inte när jag testat. -->
								MI{{m.MenuItemId}}([{{m.MenuItemId}} {{EscapeLabel(m.MenuItemName)}}])-->{{prock.Info.object_id}}
							</template>
						</template>
						<template v-else>
							<template v-if="m.Description !== null && m.Description != undefined">
								META{{index}}([{{m.Kind}} '{{EscapeLabel(m.Description)}}'])-->{{prock.Info.object_id}}
							</template>
						</template>
						
					</template >

					<template  v-for="c in prock.ReferencedBy">
					
						{{c.object_id}}[{{c.Name}}]-->{{prock.Info.object_id}}
						click {{c.object_id}} "?callback={{c.Name}}" "Hi I'm a callback, whats up"
					</template >
					
					
					<template  v-for="c in prock.Calls">
					
						{{prock.Info.object_id}}-->{{c.object_id}}[{{c.Name}}] 
						click {{c.object_id}} "?callback={{c.Name}}" "Hi I'm a callback, whats up"
					</template >

				subgraph Aktivt objekt
				{{prock.Info.object_id}}
				end
				<template v-for="s in distinctCallSchemas()">
				subgraph {{s}}out [{{s}}]
				<template v-for="p in GetSchemas(s)">
				{{p.object_id}}
				</template>
				end
				</template>
				<template v-for="s2 in distinctReferencedSchemas()">
				subgraph {{s2}}in [{{s2}}]
				<template v-for="p2 in GetReferencedSchemas(s2)">
				{{p2.object_id}}
				</template>
				end
				</template>

			</pre>
		
		</div>

    <script src="autodocGraph.js"></script>
  </body>
</html>